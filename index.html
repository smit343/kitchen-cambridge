<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sabha Manager Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100 font-sans">
  <h1 class="text-3xl font-bold mb-6">Sabha Manager Pro</h1>

  <!-- Sabha Form -->
  <form id="sabha-form" class="space-y-4 bg-white p-6 rounded shadow">
    <input type="date" id="date" placeholder="Date" class="w-full p-2 border rounded">
    <input type="text" id="event" placeholder="Event" class="w-full p-2 border rounded">
    <input type="text" id="pujyaSanto" placeholder="Pujya Santo" class="w-full p-2 border rounded">
    <input type="number" id="totalBhaktas" placeholder="Total Bhaktas" class="w-full p-2 border rounded">
    <input type="number" id="gents" placeholder="Gents" class="w-full p-2 border rounded">
    <input type="number" id="ladies" placeholder="Ladies" class="w-full p-2 border rounded">
    <textarea id="menu" placeholder="Menu" class="w-full p-2 border rounded"></textarea>
    <textarea id="ingredients" placeholder="Ingredients" class="w-full p-2 border rounded"></textarea>
    <input type="text" id="leftoverFood" placeholder="Leftover Food" class="w-full p-2 border rounded">
    <input type="text" id="remadeItems" placeholder="Remade Items" class="w-full p-2 border rounded">
    <textarea id="note" placeholder="Note" class="w-full p-2 border rounded"></textarea>
    <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Save Sabha</button>
  </form>

  <!-- Recipe Form -->
  <form id="recipe-form" class="space-y-4 bg-white p-6 rounded shadow mt-10">
    <input type="text" id="recipeName" placeholder="Recipe Name" class="w-full p-2 border rounded">
    <textarea id="recipeProcess" placeholder="Recipe Process" class="w-full p-2 border rounded"></textarea>
    <textarea id="recipeIngredients" placeholder="Ingredients" class="w-full p-2 border rounded"></textarea>
    <input type="text" id="recipeTime" placeholder="Cooking Time" class="w-full p-2 border rounded">
    <input type="file" id="recipeImage" accept="image/*" class="w-full">
    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Save Recipe</button>
  </form>

  <h2 class="text-xl font-bold mt-10 mb-4">Sabha Events</h2>
  <ul id="sabha-list" class="space-y-2"></ul>

  <h2 class="text-xl font-bold mt-10 mb-4">Recipes</h2>
  <ul id="recipe-list" class="space-y-2"></ul>

  <script>
    const sheetURL = "https://script.google.com/macros/s/AKfycbxj75vvLsPMqWffxTHIkavcp47Venefqr6OUpODFvvPrz4jUYEbHk117uXbznUNwBHv/exec";

    document.getElementById('sabha-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const sabha = {
        type: 'sabha',
        date: document.getElementById('date').value,
        event: document.getElementById('event').value,
        pujyaSanto: document.getElementById('pujyaSanto').value,
        totalBhaktas: document.getElementById('totalBhaktas').value,
        gents: document.getElementById('gents').value,
        ladies: document.getElementById('ladies').value,
        menu: document.getElementById('menu').value,
        ingredients: document.getElementById('ingredients').value,
        leftoverFood: document.getElementById('leftoverFood').value,
        remadeItems: document.getElementById('remadeItems').value,
        note: document.getElementById('note').value
      };

      try {
        const res = await fetch(sheetURL, {
          method: 'POST',
          body: JSON.stringify(sabha),
          headers: { 'Content-Type': 'application/json' }
        });
        const text = await res.text();
        alert(text);
        loadData();
      } catch (err) {
        alert("Failed to save Sabha data");
        console.error(err);
      }
    });

    document.getElementById('recipe-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById('recipeImage');
      const reader = new FileReader();

      reader.onload = async function () {
        const recipe = {
          type: 'recipe',
          name: document.getElementById('recipeName').value,
          process: document.getElementById('recipeProcess').value,
          ingredients: document.getElementById('recipeIngredients').value,
          time: document.getElementById('recipeTime').value,
          image: reader.result // base64 encoded
        };

        try {
          const res = await fetch(sheetURL, {
            method: 'POST',
            body: JSON.stringify(recipe),
            headers: { 'Content-Type': 'application/json' }
          });
          const text = await res.text();
          alert(text);
          loadData();
        } catch (err) {
          alert("Failed to save Recipe data");
          console.error(err);
        }
      };

      if (fileInput.files[0]) {
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        reader.onload(); // run with no image
      }
    });

    async function loadData() {
      try {
        const res = await fetch(sheetURL);
        const data = await res.json();

        const sabhaList = document.getElementById('sabha-list');
        const recipeList = document.getElementById('recipe-list');
        sabhaList.innerHTML = '';
        recipeList.innerHTML = '';

        data.forEach(item => {
          if (item.Type === 'sabha') {
            const li = document.createElement('li');
            li.className = "bg-white p-4 rounded shadow";
            li.innerHTML = `<strong>${item.Date}</strong>: ${item.Event} - ${item["Total Bhaktas"]} bhaktas`;
            sabhaList.appendChild(li);
          } else if (item.Type === 'recipe') {
            const li = document.createElement('li');
            li.className = "bg-white p-4 rounded shadow";
            li.innerHTML = `
              <strong>${item.Name}</strong> - ${item.Time}<br>
              <em>${item.Ingredients}</em><br>
              <img src="${item.Image}" alt="Recipe Image" class="w-32 mt-2 rounded">
            `;
            recipeList.appendChild(li);
          }
        });
      } catch (err) {
        console.error("Failed to load data", err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
